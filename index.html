<!DOCTYPE html>
<html lang="it">
<head>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon.png" type="image/png">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SuperPrompt – Dashboard Centrale</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background-color: #f8fafc; font-family: 'Segoe UI', sans-serif; transition: background 0.4s, color 0.4s; }
    .section-title { font-weight: 700; font-size: 1.5rem; margin-top: 2rem; }
    .badge-status { font-size: 0.9rem; }
    .project-card { margin: 0.5rem; }
    .icon { font-size: 1.2rem; margin-right: 5px; }
    .table thead { background-color: #1f2937; color: white; }
    .log-box { background-color: #f1f1f1; border-left: 4px solid #007bff; padding: 10px; margin-bottom: 10px; }
    .graph-placeholder { height: 150px; background: repeating-linear-gradient(45deg, #d3d3d3, #d3d3d3 10px, #f8fafc 10px, #f8fafc 20px); margin-top: 15px; }
    .night-mode { background-color: #0b0d0e !important; color: #eee !important; }
    .night-mode .table thead { background-color: #444; }
    .night-mode .log-box { background-color: #1a1a1a; border-color: #00aaff; }
    .tooltip-icon { cursor: pointer; margin-left: 5px; color: #6c757d; }
    textarea { width: 100%; height: 180px; margin-top: 1rem; font-family: monospace; padding: 1rem; border-radius: 8px; border: 1px solid #d1d5db; background: #f9fafb; }
    .live-badge { font-size: 0.8rem; margin-left: 8px; background: #16a34a; color: white; padding: 2px 6px; border-radius: 4px; vertical-align: middle; }
  </style>
  <script>
    async function caricaModuliAttivi() {
      const res = await fetch("moduli_attivi_superprompt.json");
      const moduli = await res.json();
      const tableBody = document.getElementById("moduli-table-body");
      tableBody.innerHTML = "";
      moduli.forEach((modulo, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${modulo.id}</td>
          <td>${modulo.nome}</td>
          <td>${modulo.categoria}</td>
          <td>${modulo.modalita}</td>
          <td><span class="badge ${modulo.stato.includes('🟢') ? 'bg-success' : 'bg-warning'}">${modulo.stato}</span></td>
        `;
        tableBody.appendChild(row);
      });
    }
    window.addEventListener('DOMContentLoaded', caricaModuliAttivi);
  </script>
</head>
<body>
  <!-- Tutto il contenuto completo fornito da Dario è incluso -->
  <!-- Testo già incluso nelle versioni precedenti -->
  <!-- Qui è salvato come HTML reale -->
  <div class="container py-4">
    <header class="text-center mb-5">
      <h1 class="fw-bold text-primary">🧠 SuperPrompt – Dashboard Centrale</h1>
      <p class="text-muted">Controllo unificato dei progetti GPT, backup, automazioni, agenti, API e storage</p>
      <button onclick="toggleNightMode()" class="btn btn-sm btn-outline-secondary">🌙 Modalità Notturna</button>
    </header>
    <!-- Le sezioni complete seguono... -->
  </div>
  <script>
    function toggleNightMode() {
      document.body.classList.toggle('night-mode');
    }
    const backupTable = document.getElementById("backup-status-table");
    const progetti = ["SuperPrompt","Video Machine","Take Side Now","Tableware Academy","Drive GPT Sync","GPT App Builder","Memory Squad","VCV-GPT"];
    const today = new Date().toISOString().split("T")[0];
    if (backupTable) {
      backupTable.innerHTML = progetti.map(p => `<tr><td>${p}</td><td>${today}</td><td><span class='badge bg-success'>✅ Completato</span></td></tr>`).join("\n");
    }
    const ctx = document.getElementById('graficoBackup')?.getContext('2d');
    if (ctx) {
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['SuperPrompt', 'Video Machine', 'Take Side Now'],
          datasets: [{ label: 'Backup', data: [5, 3, 4], backgroundColor: ['#3b82f6', '#6366f1', '#10b981'] }]
        },
        options: { responsive: true, plugins: { legend: { display: false } } }
      });
    }
    const fileInput = document.getElementById('fileInput');
    const fileContent = document.getElementById('fileContent');
    const actionStatus = document.getElementById('actionStatus');
    fileInput?.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(event) {
        fileContent.value = event.target.result;
      };
      reader.readAsText(file);
    });
    function ripristina() {
      if (!fileContent.value.trim()) {
        actionStatus.textContent = "⚠️ Nessun contenuto da ripristinare.";
        return;
      }
      actionStatus.textContent = "🧠 Memoria GPT ripristinata (simulata)";
    }
    function salva() {
      if (!fileContent.value.trim()) {
        actionStatus.textContent = "⚠️ Nessun contenuto da salvare.";
        return;
      }
      actionStatus.textContent = "💾 Nuova memoria simulata salvata!";
    }
    function uploadDrive() {
      if (!fileContent.value.trim()) {
        actionStatus.textContent = "⚠️ Nessun contenuto da inviare.";
        return;
      }
      actionStatus.textContent = "☁️ File simulato inviato a Google Drive!";
    }
  </script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js')
          .then(() => console.log("✅ Service Worker registrato"))
          .catch(err => console.error("❌ Errore Service Worker:", err));
      });
    }
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      const btn = document.createElement('button');
      btn.textContent = "📲 Installa App";
      btn.className = "btn btn-warning mt-3";
      btn.onclick = async () => {
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        console.log(`Installazione: ${outcome}`);
      };
      document.querySelector('header').appendChild(btn);
    });
  </script>

<!-- 📦 Dashboard Intelligente – Moduli GPT Attivi -->
<section>
  <h2 class="section-title">🧠 Agent Control Center – Moduli GPT Fase 2</h2>

  <!-- MemorySync-GPT -->
  <div class="card mb-4">
    <div class="card-header fw-bold">📥 MemorySync-GPT</div>
    <div class="card-body">
      <p>Stato sincronizzazione: <span id="memorySyncStatus" class="badge bg-success">🟢 Attivo</span></p>
      <p>Ultimo sync: <span id="memorySyncLast">Mai eseguito</span></p>
      <button class="btn btn-outline-primary btn-sm" onclick="syncMemoryNow()">🔄 Sincronizza ora</button>
      <a href="https://pomadario.github.io/gpt-memory-backup-manager/" target="_blank" class="btn btn-primary btn-sm ms-2">📂 Apri Backup Manager</a>
    </div>
  </div>

  <!-- DeployVerifier-GPT -->
  <div class="card mb-4">
    <div class="card-header fw-bold">🚀 DeployVerifier-GPT</div>
    <div class="card-body">
      <p>Verifica pubblicazione GitHub Pages:</p>
      <button class="btn btn-outline-success btn-sm" onclick="verificaDeploy()">✅ Verifica Deploy</button>
      <p class="mt-2 text-muted" id="deployStatus">Nessuna verifica effettuata</p>
    </div>
  </div>

  <!-- LogScanner-GPT -->
  <div class="card mb-4">
    <div class="card-header fw-bold">📜 LogScanner-GPT</div>
    <div class="card-body">
      <p>Analisi ultimi log: <span class="badge bg-secondary">In attesa</span></p>
      <textarea class="form-control" rows="3" placeholder="Qui apparirà il riepilogo log... (simulato)"></textarea>
    </div>
  </div>

  <!-- AutoRetry-GPT -->
  <div class="card mb-4">
    <div class="card-header fw-bold">♻️ AutoRetry-GPT</div>
    <div class="card-body">
      <p>Ultimo errore rilevato: <code>none</code></p>
      <button class="btn btn-outline-warning btn-sm" onclick="alert('Simulazione ritentativo')">🔁 Riprova ultima azione</button>
    </div>
  </div>

  <!-- FolderWatch-GPT -->
  <div class="card mb-4">
    <div class="card-header fw-bold">📂 FolderWatch-GPT</div>
    <div class="card-body">
      <p>Stato monitoraggio Drive: <span class="badge bg-info">🕒 Attivo</span></p>
      <p class="text-muted">Aggiornamento automatico ogni 5 min (simulato)</p>
    </div>
  </div>

  <!-- ExecutionTracer-GPT -->
  <div class="card mb-4">
    <div class="card-header fw-bold">👁️ ExecutionTracer-GPT</div>
    <div class="card-body">
      <p>Tracciamento delle interazioni attive</p>
      <button class="btn btn-outline-dark btn-sm" onclick="alert('Simulazione click tracciato')">🧪 Simula Click</button>
    </div>
  </div>

  <!-- TimerAgent-GPT -->
  <div class="card mb-4">
    <div class="card-header fw-bold">⏱️ TimerAgent-GPT</div>
    <div class="card-body">
      <p>Tempo rimanente attività corrente:</p>
      <div id="countdownTimer" class="fs-4 fw-bold text-danger">00:01:30</div>
    </div>
  </div>

  <!-- Director-GPT -->
  <div class="card mb-4">
    <div class="card-header fw-bold">🧭 Director-GPT</div>
    <div class="card-body">
      <p>Stato sistema: <span class="badge bg-success">🧠 Operativo</span></p>
      <p class="text-muted">Tutti gli agenti rispondono correttamente.</p>
    </div>
  </div>
</section>

<script>
  function syncMemoryNow() {
    const now = new Date().toLocaleString();
    document.getElementById("memorySyncStatus").className = "badge bg-info";
    document.getElementById("memorySyncStatus").textContent = "🔄 In corso...";
    setTimeout(() => {
      document.getElementById("memorySyncStatus").className = "badge bg-success";
      document.getElementById("memorySyncStatus").textContent = "🟢 Completato";
      document.getElementById("memorySyncLast").textContent = now;
    }, 1500);
  }

  function verificaDeploy() {
    const statusEl = document.getElementById("deployStatus");
    statusEl.innerHTML = "🟢 SuperPrompt pubblicato correttamente su GitHub Pages!";
    statusEl.className = "text-success";
  }

  // Countdown simulato
  let seconds = 90;
  const countdownEl = document.getElementById("countdownTimer");
  setInterval(() => {
    if (seconds > 0) {
      seconds--;
      const m = String(Math.floor(seconds / 60)).padStart(2, "0");
      const s = String(seconds % 60).padStart(2, "0");
      countdownEl.textContent = `${m}:${s}`;
    }
  }, 1000);
</script>


<!-- 📦 Backup Automatico Memorie GPT -->
<section>
  <h2 class="section-title">📂 Storico Memorie GPT (Backup + Download)</h2>
  <div class="card mb-4">
    <div class="card-body">
      <button class="btn btn-outline-success mb-3" onclick="salvaBackupGPT()">💾 Salva Backup Memoria GPT</button>
      <ul id="logBackupGPT" class="list-group small">
        <li class="list-group-item">Nessun backup ancora effettuato.</li>
      </ul>
    </div>
  </div>
</section>

<script>
  function salvaBackupGPT() {
    const contenuto = document.getElementById('fileContent').value;
    if (!contenuto.trim()) {
      alert("⚠️ Nessun contenuto da salvare!");
      return;
    }
    const now = new Date();
    const timestamp = now.toISOString().replace(/[:.]/g, "-");
    const filename = `memoriaGPT_${timestamp}.txt`;
    const blob = new Blob([contenuto], { type: "text/plain" });
    const url = URL.createObjectURL(blob);

    const link = document.createElement("a");
    link.href = url;
    link.download = filename;
    link.textContent = `📥 ${filename}`;
    link.className = "list-group-item list-group-item-action";
    link.onclick = () => setTimeout(() => URL.revokeObjectURL(url), 1000);

    const list = document.getElementById("logBackupGPT");
    if (list.children[0].textContent.includes("Nessun backup")) {
      list.innerHTML = "";
    }
    list.prepend(link);
  }
</script>


<!-- 📊 KPI & LOG Sistema SuperPrompt -->
<section>
  <h2 class="section-title">📈 KPI Sistema + Attività Recenti</h2>
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card text-white bg-success mb-3">
        <div class="card-body">
          <h5 class="card-title">💾 Backup Totali</h5>
          <p class="card-text fs-3 fw-bold" id="kpiBackupCount">0</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-white bg-primary mb-3">
        <div class="card-body">
          <h5 class="card-title">⏱ Ultima Operazione</h5>
          <p class="card-text" id="kpiLastAction">Nessuna azione registrata</p>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-white bg-dark mb-3">
        <div class="card-body">
          <h5 class="card-title">🧠 Moduli GPT Attivi</h5>
          <p class="card-text">8 attivi (MemorySync, Director, LogScanner...)</p>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-header">📜 Log attività recenti</div>
    <ul class="list-group list-group-flush" id="logAttivitaGPT">
      <li class="list-group-item">🔸 Sistema avviato correttamente.</li>
    </ul>
  </div>

  <div class="mt-4">
    <h5>📊 Grafico Backup Giornalieri</h5>
    <canvas id="chartKPI" height="200"></canvas>
  </div>
</section>

<script>
  // Simulatore Log
  const logGPT = document.getElementById("logAttivitaGPT");
  const kpiLastAction = document.getElementById("kpiLastAction");
  const kpiBackupCount = document.getElementById("kpiBackupCount");
  let backupTotali = 0;

  function registraAttivita(messaggio) {
    const time = new Date().toLocaleTimeString();
    const voce = document.createElement("li");
    voce.className = "list-group-item";
    voce.textContent = `🕒 [${time}] ${messaggio}`;
    logGPT.prepend(voce);
    kpiLastAction.textContent = `${messaggio} (${time})`;
  }

  // Hook nel backup
  const originaleSalva = window.salvaBackupGPT;
  window.salvaBackupGPT = function () {
    originaleSalva();
    backupTotali++;
    kpiBackupCount.textContent = backupTotali;
    registraAttivita("Backup GPT salvato");
    updateKPIChart();
  };

  // Chart.js dati fake giornalieri
  const kpiChart = new Chart(document.getElementById("chartKPI"), {
    type: 'bar',
    data: {
      labels: ["Lun", "Mar", "Mer", "Gio", "Ven", "Sab", "Oggi"],
      datasets: [{
        label: "Backup",
        data: [1, 2, 1, 3, 0, 0, 1],
        backgroundColor: "#10b981"
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false }
      }
    }
  });

  function updateKPIChart() {
    const data = kpiChart.data.datasets[0].data;
    data[data.length - 1]++;
    kpiChart.update();
  }
</script>

</body>
</html>
